{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Vault Access Operator","text":"<p>A Kubernetes operator for managing HashiCorp Vault access policies and Kubernetes authentication roles declaratively through Custom Resource Definitions (CRDs).</p>"},{"location":"#overview","title":"Overview","text":"<p>The Vault Access Operator enables platform teams to manage Vault policies and Kubernetes authentication roles using native Kubernetes resources. It provides a GitOps-friendly approach to Vault access management, allowing teams to version control their Vault configurations alongside their application deployments.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Declarative Vault Policy Management - Define Vault policies as Kubernetes resources</li> <li>Kubernetes Auth Role Management - Configure Vault Kubernetes authentication roles through CRDs</li> <li>Namespace Boundary Enforcement - Automatically restrict namespaced policies to their namespace scope</li> <li>Multiple Authentication Methods - Support for Kubernetes, Token, and AppRole authentication</li> <li>Conflict Detection and Handling - Choose between fail-fast or adopt strategies for existing resources</li> <li>Automatic Policy Generation - Generate Vault HCL policies from structured rule definitions</li> <li>Variable Substitution - Use <code>{{namespace}}</code> and <code>{{name}}</code> variables in policy paths</li> <li>Exponential Backoff Retry - Intelligent retry with jitter for transient failures</li> <li>Deletion Policies - Control whether Vault resources are retained or deleted when K8s resources are removed</li> <li>Admission Webhooks - Validate resources before creation with detailed error messages</li> </ul>"},{"location":"#quick-installation","title":"Quick Installation","text":"Helm (Recommended)kubectl <pre><code>helm repo add vault-access-operator https://panteparak.github.io/vault-access-operator/charts\nhelm install vault-access-operator vault-access-operator/vault-access-operator \\\n  --namespace vault-access-operator-system \\\n  --create-namespace\n</code></pre> <pre><code>kubectl apply -f https://raw.githubusercontent.com/panteparak/vault-access-operator/main/dist/install.yaml\n</code></pre> <p>For detailed installation instructions, see the Getting Started guide.</p>"},{"location":"#custom-resource-definitions","title":"Custom Resource Definitions","text":"<p>The operator provides five CRDs for managing Vault access:</p> CRD Scope Description VaultConnection Cluster Establishes connection to Vault server VaultClusterPolicy Cluster Manages cluster-wide Vault policies VaultPolicy Namespaced Manages namespace-scoped Vault policies VaultClusterRole Cluster Manages cluster-wide Kubernetes auth roles VaultRole Namespaced Manages namespace-scoped Kubernetes auth roles"},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster (v1.25+)</li> <li>HashiCorp Vault server</li> <li>cert-manager (for webhook certificates, optional)</li> <li>kubectl configured to access your cluster</li> </ul>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Getting Started - Installation and quick start guide</li> <li>Configuration - Helm chart configuration options</li> <li>API Reference - Detailed CRD documentation</li> <li>Examples - CRD usage examples</li> <li>Troubleshooting - Common issues and solutions</li> </ul>"},{"location":"#community","title":"Community","text":"<ul> <li>GitHub Repository</li> <li>Issue Tracker</li> </ul>"},{"location":"#license","title":"License","text":"<p>Copyright 2024-2026 Vault Access Operator Contributors.</p> <p>Licensed under the Apache License, Version 2.0.</p>"},{"location":"api-reference/","title":"API Reference","text":"<p>This page documents all Custom Resource Definitions (CRDs) provided by the Vault Access Operator.</p>"},{"location":"api-reference/#overview","title":"Overview","text":"CRD Scope Description VaultConnection Cluster Establishes connection to Vault server VaultPolicy Namespaced Manages namespace-scoped Vault policies VaultClusterPolicy Cluster Manages cluster-wide Vault policies VaultRole Namespaced Manages namespace-scoped Kubernetes auth roles VaultClusterRole Cluster Manages cluster-wide Kubernetes auth roles <p>All CRDs belong to the <code>vault.platform.io</code> API group with version <code>v1alpha1</code>.</p>"},{"location":"api-reference/#common-concepts","title":"Common Concepts","text":""},{"location":"api-reference/#conflict-policies","title":"Conflict Policies","text":"<p>When creating resources that may already exist in Vault:</p> Policy Behavior <code>Fail</code> Fail if a resource with the same name exists (default) <code>Adopt</code> Adopt and manage the existing resource"},{"location":"api-reference/#deletion-policies","title":"Deletion Policies","text":"<p>Control what happens when a Kubernetes resource is deleted:</p> Policy Behavior <code>Delete</code> Delete the resource from Vault (default) <code>Retain</code> Keep the resource in Vault"},{"location":"api-reference/#variable-substitution","title":"Variable Substitution","text":"<p>Policies support variable substitution in paths:</p> Variable Substituted With <code>{{namespace}}</code> The Kubernetes namespace of the resource <code>{{name}}</code> The name of the Kubernetes resource"},{"location":"api-reference/#resource-phases","title":"Resource Phases","text":"<p>All resources report their current phase in status:</p> Phase Description <code>Pending</code> Resource is being processed <code>Active</code> Resource is successfully synced to Vault <code>Failed</code> Resource sync failed <code>Conflict</code> Conflict with existing Vault resource"},{"location":"api-reference/#vaultconnection","title":"VaultConnection","text":"<p>Establishes and manages a connection to a HashiCorp Vault server.</p> <ul> <li>Scope: Cluster</li> <li>Short Name: N/A</li> </ul>"},{"location":"api-reference/#example","title":"Example","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultConnection\nmetadata:\n  name: vault-primary\nspec:\n  address: https://vault.example.com:8200\n  auth:\n    kubernetes:\n      role: vault-access-operator\n  healthCheckInterval: 30s\n</code></pre>"},{"location":"api-reference/#spec-fields","title":"Spec Fields","text":"Field Type Required Default Description <code>address</code> string Yes - Vault server address <code>auth</code> AuthConfig Yes - Authentication configuration <code>tls</code> TLSConfig No - TLS configuration <code>healthCheckInterval</code> duration No <code>30s</code> Health check interval"},{"location":"api-reference/#authconfig","title":"AuthConfig","text":"Field Type Description <code>kubernetes</code> KubernetesAuth Kubernetes service account authentication <code>token</code> TokenAuth Static token authentication <code>appRole</code> AppRoleAuth AppRole authentication <code>bootstrap</code> BootstrapAuth One-time bootstrap authentication"},{"location":"api-reference/#kubernetesauth","title":"KubernetesAuth","text":"Field Type Default Description <code>role</code> string Required Vault role to authenticate as <code>authPath</code> string <code>kubernetes</code> Mount path of Kubernetes auth method"},{"location":"api-reference/#tlsconfig","title":"TLSConfig","text":"Field Type Default Description <code>skipVerify</code> bool <code>false</code> Skip TLS verification (not recommended) <code>caSecretRef</code> SecretKeySelector - Reference to CA certificate secret"},{"location":"api-reference/#status-fields","title":"Status Fields","text":"Field Type Description <code>phase</code> string <code>Pending</code>, <code>Active</code>, <code>Error</code> <code>vaultVersion</code> string Version of connected Vault server <code>lastHeartbeat</code> time Time of last successful health check"},{"location":"api-reference/#kubectl-output","title":"kubectl Output","text":"<pre><code>$ kubectl get vaultconnection\nNAME            ADDRESS                          PHASE    VERSION   AGE\nvault-primary   https://vault.example.com:8200   Active   1.15.0    5d\n</code></pre>"},{"location":"api-reference/#vaultpolicy","title":"VaultPolicy","text":"<p>Manages namespace-scoped Vault policies.</p> <ul> <li>Scope: Namespaced</li> <li>Short Name: <code>vp</code></li> <li>Vault Name Format: <code>{namespace}-{name}</code></li> </ul>"},{"location":"api-reference/#example_1","title":"Example","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: app-secrets\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/data/{{namespace}}/*\"\n      capabilities: [read, list]\n      description: \"Read application secrets\"\n</code></pre>"},{"location":"api-reference/#spec-fields_1","title":"Spec Fields","text":"Field Type Required Default Description <code>connectionRef</code> string Yes - Name of VaultConnection to use <code>rules</code> []PolicyRule Yes - List of policy rules (min 1) <code>conflictPolicy</code> string No <code>Fail</code> <code>Fail</code> or <code>Adopt</code> <code>deletionPolicy</code> string No <code>Delete</code> <code>Delete</code> or <code>Retain</code> <code>enforceNamespaceBoundary</code> bool No <code>false</code> Require <code>{{namespace}}</code> in all paths"},{"location":"api-reference/#policyrule","title":"PolicyRule","text":"Field Type Description <code>path</code> string Vault path (supports <code>{{namespace}}</code>, <code>{{name}}</code>) <code>capabilities</code> []string <code>create</code>, <code>read</code>, <code>update</code>, <code>delete</code>, <code>list</code>, <code>sudo</code>, <code>deny</code> <code>description</code> string Optional description"},{"location":"api-reference/#status-fields_1","title":"Status Fields","text":"Field Type Description <code>phase</code> string <code>Pending</code>, <code>Syncing</code>, <code>Active</code>, <code>Conflict</code>, <code>Error</code> <code>vaultName</code> string Name of policy in Vault <code>rulesCount</code> int Number of rules <code>lastSyncedAt</code> time Time of last successful sync"},{"location":"api-reference/#kubectl-output_1","title":"kubectl Output","text":"<pre><code>$ kubectl get vaultpolicy -n my-app\nNAME          VAULT NAME          PHASE    RULES   AGE\napp-secrets   my-app-app-secrets  Active   2       1h\n</code></pre>"},{"location":"api-reference/#vaultclusterpolicy","title":"VaultClusterPolicy","text":"<p>Manages cluster-wide Vault policies.</p> <ul> <li>Scope: Cluster</li> <li>Short Name: <code>vcp</code></li> <li>Vault Name Format: <code>{name}</code> (same as resource name)</li> </ul>"},{"location":"api-reference/#example_2","title":"Example","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterPolicy\nmetadata:\n  name: shared-secrets-reader\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/data/shared/*\"\n      capabilities: [read, list]\n      description: \"Read shared configuration\"\n</code></pre>"},{"location":"api-reference/#spec-fields_2","title":"Spec Fields","text":"Field Type Required Default Description <code>connectionRef</code> string Yes - Name of VaultConnection to use <code>rules</code> []PolicyRule Yes - List of policy rules (min 1) <code>conflictPolicy</code> string No <code>Fail</code> <code>Fail</code> or <code>Adopt</code> <code>deletionPolicy</code> string No <code>Delete</code> <code>Delete</code> or <code>Retain</code>"},{"location":"api-reference/#comparison-with-vaultpolicy","title":"Comparison with VaultPolicy","text":"Feature VaultPolicy VaultClusterPolicy Scope Namespaced Cluster Vault name <code>{namespace}-{name}</code> <code>{name}</code> Variables <code>{{namespace}}</code>, <code>{{name}}</code> <code>{{name}}</code> only Namespace boundary Optional N/A"},{"location":"api-reference/#kubectl-output_2","title":"kubectl Output","text":"<pre><code>$ kubectl get vaultclusterpolicy\nNAME                    VAULT NAME              PHASE    RULES   AGE\nshared-secrets-reader   shared-secrets-reader   Active   2       5d\n</code></pre>"},{"location":"api-reference/#vaultrole","title":"VaultRole","text":"<p>Manages namespace-scoped Kubernetes authentication roles in Vault.</p> <ul> <li>Scope: Namespaced</li> <li>Short Name: <code>vr</code></li> <li>Vault Role Name Format: <code>{namespace}-{name}</code></li> </ul>"},{"location":"api-reference/#example_3","title":"Example","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultRole\nmetadata:\n  name: app-role\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - default\n  policies:\n    - kind: VaultPolicy\n      name: app-secrets\n  tokenTTL: 1h\n</code></pre>"},{"location":"api-reference/#spec-fields_3","title":"Spec Fields","text":"Field Type Required Default Description <code>connectionRef</code> string Yes - Name of VaultConnection to use <code>serviceAccounts</code> []string Yes - Service account names (same namespace) <code>policies</code> []PolicyReference Yes - Policies to attach (min 1) <code>authPath</code> string No From connection Kubernetes auth mount path <code>conflictPolicy</code> string No <code>Fail</code> <code>Fail</code> or <code>Adopt</code> <code>deletionPolicy</code> string No <code>Delete</code> <code>Delete</code> or <code>Retain</code> <code>tokenTTL</code> duration No Vault default Default token TTL <code>tokenMaxTTL</code> duration No Vault default Maximum token TTL"},{"location":"api-reference/#policyreference","title":"PolicyReference","text":"Field Type Description <code>kind</code> string <code>VaultPolicy</code> or <code>VaultClusterPolicy</code> <code>name</code> string Name of the policy resource <code>namespace</code> string Namespace (only for VaultPolicy, defaults to same)"},{"location":"api-reference/#status-fields_2","title":"Status Fields","text":"Field Type Description <code>phase</code> string <code>Pending</code>, <code>Syncing</code>, <code>Active</code>, <code>Conflict</code>, <code>Error</code> <code>vaultRoleName</code> string Name of role in Vault <code>boundServiceAccounts</code> []string Resolved service account names <code>resolvedPolicies</code> []string Resolved Vault policy names"},{"location":"api-reference/#kubectl-output_3","title":"kubectl Output","text":"<pre><code>$ kubectl get vaultrole -n my-app\nNAME       VAULT ROLE        PHASE    POLICIES                               AGE\napp-role   my-app-app-role   Active   [\"my-app-app-secrets\",\"shared-reader\"] 1h\n</code></pre>"},{"location":"api-reference/#vaultclusterrole","title":"VaultClusterRole","text":"<p>Manages cluster-wide Kubernetes authentication roles in Vault.</p> <ul> <li>Scope: Cluster</li> <li>Short Name: <code>vcr</code></li> <li>Vault Role Name Format: <code>{name}</code> (same as resource name)</li> </ul>"},{"location":"api-reference/#example_4","title":"Example","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterRole\nmetadata:\n  name: platform-services\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - name: platform-controller\n      namespace: platform-system\n  policies:\n    - kind: VaultClusterPolicy\n      name: shared-secrets-reader\n  tokenTTL: 1h\n</code></pre>"},{"location":"api-reference/#spec-fields_4","title":"Spec Fields","text":"Field Type Required Default Description <code>connectionRef</code> string Yes - Name of VaultConnection to use <code>serviceAccounts</code> []ServiceAccountRef Yes - Service accounts with namespace <code>policies</code> []PolicyReference Yes - Policies to attach (min 1) <code>authPath</code> string No From connection Kubernetes auth mount path <code>conflictPolicy</code> string No <code>Fail</code> <code>Fail</code> or <code>Adopt</code> <code>deletionPolicy</code> string No <code>Delete</code> <code>Delete</code> or <code>Retain</code> <code>tokenTTL</code> duration No Vault default Default token TTL <code>tokenMaxTTL</code> duration No Vault default Maximum token TTL"},{"location":"api-reference/#serviceaccountref","title":"ServiceAccountRef","text":"Field Type Description <code>name</code> string Name of the service account <code>namespace</code> string Namespace of the service account"},{"location":"api-reference/#comparison-with-vaultrole","title":"Comparison with VaultRole","text":"Feature VaultRole VaultClusterRole Scope Namespaced Cluster Vault role name <code>{namespace}-{name}</code> <code>{name}</code> Service accounts Same namespace only Any namespace"},{"location":"api-reference/#kubectl-output_4","title":"kubectl Output","text":"<pre><code>$ kubectl get vaultclusterrole\nNAME                VAULT ROLE          PHASE    POLICIES                    AGE\nplatform-services   platform-services   Active   [\"shared-secrets-reader\"]   5d\n</code></pre>"},{"location":"api-reference/#secretkeyselector","title":"SecretKeySelector","text":"<p>Reference to a key in a Kubernetes Secret (used in multiple CRDs):</p> Field Type Description <code>name</code> string Name of the Secret <code>namespace</code> string Namespace (defaults to resource namespace) <code>key</code> string Key within the Secret"},{"location":"api-reference/#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started - Installation guide</li> <li>Examples - CRD usage examples</li> <li>Troubleshooting - Common issues</li> </ul>"},{"location":"configuration/","title":"Configuration","text":"<p>This page documents all available Helm chart configuration options.</p>"},{"location":"configuration/#installation","title":"Installation","text":"<pre><code>helm repo add vault-access-operator https://panteparak.github.io/vault-access-operator/charts\nhelm install vault-access-operator vault-access-operator/vault-access-operator \\\n  --namespace vault-access-operator-system \\\n  --create-namespace \\\n  -f values.yaml\n</code></pre>"},{"location":"configuration/#values-reference","title":"Values Reference","text":""},{"location":"configuration/#basic-configuration","title":"Basic Configuration","text":"Parameter Description Default <code>replicaCount</code> Number of operator replicas <code>1</code> <code>nameOverride</code> Override the chart name <code>\"\"</code> <code>fullnameOverride</code> Override the full release name <code>\"\"</code>"},{"location":"configuration/#image-configuration","title":"Image Configuration","text":"Parameter Description Default <code>image.repository</code> Image repository <code>ghcr.io/panteparak/vault-access-operator</code> <code>image.pullPolicy</code> Image pull policy <code>IfNotPresent</code> <code>image.tag</code> Image tag (defaults to chart appVersion) <code>\"\"</code> <code>imagePullSecrets</code> Image pull secrets for private registries <code>[]</code>"},{"location":"configuration/#service-account","title":"Service Account","text":"Parameter Description Default <code>serviceAccount.create</code> Create a service account <code>true</code> <code>serviceAccount.annotations</code> Annotations for the service account <code>{}</code> <code>serviceAccount.name</code> Service account name <code>\"\"</code>"},{"location":"configuration/#resources","title":"Resources","text":"Parameter Description Default <code>resources.limits.cpu</code> CPU limit <code>500m</code> <code>resources.limits.memory</code> Memory limit <code>256Mi</code> <code>resources.requests.cpu</code> CPU request <code>100m</code> <code>resources.requests.memory</code> Memory request <code>128Mi</code>"},{"location":"configuration/#security-context","title":"Security Context","text":"Parameter Description Default <code>podSecurityContext.runAsNonRoot</code> Run as non-root user <code>true</code> <code>podSecurityContext.seccompProfile.type</code> Seccomp profile <code>RuntimeDefault</code> <code>securityContext.allowPrivilegeEscalation</code> Allow privilege escalation <code>false</code> <code>securityContext.capabilities.drop</code> Dropped capabilities <code>[\"ALL\"]</code> <code>securityContext.readOnlyRootFilesystem</code> Read-only root filesystem <code>true</code>"},{"location":"configuration/#webhooks","title":"Webhooks","text":"Parameter Description Default <code>webhook.enabled</code> Enable admission webhooks <code>true</code> <code>webhook.port</code> Webhook server port <code>9443</code> <code>webhook.failurePolicy</code> Webhook failure policy <code>Fail</code> <code>webhook.timeoutSeconds</code> Webhook timeout <code>10</code>"},{"location":"configuration/#webhook-certificates","title":"Webhook Certificates","text":"Parameter Description Default <code>webhook.certManager.enabled</code> Use cert-manager for certificates <code>true</code> <code>webhook.certManager.issuerName</code> Cert-manager issuer name <code>\"\"</code> <code>webhook.certManager.duration</code> Certificate duration <code>8760h</code> <code>webhook.selfSigned.enabled</code> Generate self-signed certificates <code>false</code> <code>webhook.selfSigned.validityDays</code> Certificate validity (days) <code>365</code>"},{"location":"configuration/#metrics","title":"Metrics","text":"Parameter Description Default <code>metrics.enabled</code> Enable metrics endpoint <code>true</code> <code>metrics.secure</code> Use HTTPS for metrics <code>true</code> <code>metrics.port</code> Metrics port <code>8443</code>"},{"location":"configuration/#servicemonitor-prometheus","title":"ServiceMonitor (Prometheus)","text":"Parameter Description Default <code>serviceMonitor.enabled</code> Create ServiceMonitor resource <code>false</code> <code>serviceMonitor.namespace</code> Namespace for ServiceMonitor <code>\"\"</code> <code>serviceMonitor.labels</code> Labels for ServiceMonitor <code>{}</code> <code>serviceMonitor.interval</code> Scrape interval <code>30s</code>"},{"location":"configuration/#logging","title":"Logging","text":"Parameter Description Default <code>logging.level</code> Log level (debug, info, error) <code>info</code> <code>logging.development</code> Development mode <code>false</code> <code>logging.encoder</code> Log encoder (json, console) <code>json</code>"},{"location":"configuration/#pod-disruption-budget","title":"Pod Disruption Budget","text":"Parameter Description Default <code>podDisruptionBudget.enabled</code> Enable PDB <code>false</code> <code>podDisruptionBudget.minAvailable</code> Minimum available pods <code>1</code>"},{"location":"configuration/#scheduling","title":"Scheduling","text":"Parameter Description Default <code>nodeSelector</code> Node selector for scheduling <code>{}</code> <code>tolerations</code> Tolerations for scheduling <code>[]</code> <code>affinity</code> Affinity rules for scheduling <code>{}</code> <code>priorityClassName</code> Priority class name <code>\"\"</code>"},{"location":"configuration/#example-values-files","title":"Example Values Files","text":""},{"location":"configuration/#minimal","title":"Minimal","text":"<pre><code># values-minimal.yaml\nreplicaCount: 1\n\nwebhook:\n  certManager:\n    enabled: true\n\nlogging:\n  level: info\n</code></pre>"},{"location":"configuration/#production","title":"Production","text":"<pre><code># values-production.yaml\nreplicaCount: 3\n\nresources:\n  limits:\n    cpu: \"1\"\n    memory: 512Mi\n  requests:\n    cpu: 250m\n    memory: 256Mi\n\naffinity:\n  podAntiAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 100\n        podAffinityTerm:\n          labelSelector:\n            matchLabels:\n              app.kubernetes.io/name: vault-access-operator\n          topologyKey: kubernetes.io/hostname\n\npodDisruptionBudget:\n  enabled: true\n  minAvailable: 2\n\npriorityClassName: system-cluster-critical\n\nlogging:\n  level: info\n  encoder: json\n\nwebhook:\n  enabled: true\n  failurePolicy: Fail\n  certManager:\n    enabled: true\n\nmetrics:\n  enabled: true\n\nserviceMonitor:\n  enabled: true\n  interval: 30s\n</code></pre>"},{"location":"configuration/#development","title":"Development","text":"<pre><code># values-dev.yaml\nreplicaCount: 1\n\nlogging:\n  level: debug\n  development: true\n  encoder: console\n\nresources:\n  limits:\n    cpu: 200m\n    memory: 128Mi\n  requests:\n    cpu: 50m\n    memory: 64Mi\n\nwebhook:\n  enabled: true\n  failurePolicy: Ignore\n  certManager:\n    enabled: true\n</code></pre>"},{"location":"configuration/#without-webhooks","title":"Without Webhooks","text":"<pre><code># values-no-webhooks.yaml\nwebhook:\n  enabled: false\n</code></pre>"},{"location":"configuration/#without-cert-manager","title":"Without cert-manager","text":"Self-signed CertificatesDisable Webhooks <pre><code># values-self-signed.yaml\nwebhook:\n  enabled: true\n  certManager:\n    enabled: false\n  selfSigned:\n    enabled: true\n    validityDays: 365\n</code></pre> <pre><code># values-no-webhooks.yaml\nwebhook:\n  enabled: false\n</code></pre>"},{"location":"configuration/#with-prometheus-monitoring","title":"With Prometheus Monitoring","text":"<pre><code># values-monitoring.yaml\nmetrics:\n  enabled: true\n  secure: true\n  port: 8443\n\nserviceMonitor:\n  enabled: true\n  namespace: monitoring\n  labels:\n    release: prometheus\n  interval: 30s\n  scrapeTimeout: 10s\n</code></pre>"},{"location":"configuration/#air-gapped-environment","title":"Air-gapped Environment","text":"<pre><code># values-airgapped.yaml\nimage:\n  repository: internal-registry.example.com/vault-access-operator\n  pullPolicy: IfNotPresent\n  tag: \"v0.1.0\"\n\nimagePullSecrets:\n  - name: internal-registry-creds\n\nwebhook:\n  certManager:\n    enabled: false\n  selfSigned:\n    enabled: true\n</code></pre>"},{"location":"configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started - Installation guide</li> <li>API Reference - CRD documentation</li> <li>Examples - CRD usage examples</li> </ul>"},{"location":"examples/","title":"Examples","text":"<p>This page provides complete CRD examples for various deployment scenarios.</p>"},{"location":"examples/#vaultconnection-examples","title":"VaultConnection Examples","text":""},{"location":"examples/#basic-kubernetes-auth","title":"Basic Kubernetes Auth","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultConnection\nmetadata:\n  name: vault-primary\nspec:\n  address: https://vault.example.com:8200\n  auth:\n    kubernetes:\n      role: vault-access-operator\n  healthCheckInterval: 30s\n</code></pre>"},{"location":"examples/#with-tls-ca-certificate","title":"With TLS CA Certificate","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultConnection\nmetadata:\n  name: vault-with-tls\nspec:\n  address: https://vault.internal:8200\n  auth:\n    kubernetes:\n      role: vault-access-operator\n      authPath: kubernetes\n  tls:\n    skipVerify: false\n    caSecretRef:\n      name: vault-ca-cert\n      namespace: vault-access-operator-system\n      key: ca.crt\n</code></pre>"},{"location":"examples/#bootstrap-with-token","title":"Bootstrap with Token","text":"<p>Use a one-time token to bootstrap Kubernetes auth:</p> <pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultConnection\nmetadata:\n  name: vault-bootstrap\nspec:\n  address: https://vault.example.com:8200\n  auth:\n    bootstrap:\n      secretRef:\n        name: vault-bootstrap-token\n        namespace: vault-access-operator-system\n        key: token\n      autoRevoke: true\n    kubernetes:\n      role: vault-access-operator\n</code></pre>"},{"location":"examples/#approle-authentication","title":"AppRole Authentication","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultConnection\nmetadata:\n  name: vault-approle\nspec:\n  address: https://vault.example.com:8200\n  auth:\n    appRole:\n      roleId: \"your-role-id\"\n      secretIdRef:\n        name: vault-approle-secret\n        namespace: vault-access-operator-system\n        key: secret-id\n      mountPath: approle\n</code></pre>"},{"location":"examples/#vaultpolicy-examples","title":"VaultPolicy Examples","text":""},{"location":"examples/#simple-read-policy","title":"Simple Read Policy","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: app-secrets\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/data/{{namespace}}/*\"\n      capabilities: [read, list]\n      description: \"Read application secrets\"\n</code></pre>"},{"location":"examples/#full-crud-access","title":"Full CRUD Access","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: app-full-access\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  enforceNamespaceBoundary: true\n  rules:\n    - path: \"secret/data/{{namespace}}/*\"\n      capabilities: [create, read, update, delete, list]\n      description: \"Full access to namespace secrets\"\n    - path: \"secret/metadata/{{namespace}}/*\"\n      capabilities: [read, list, delete]\n      description: \"Manage secret metadata\"\n</code></pre>"},{"location":"examples/#transit-encryption-policy","title":"Transit Encryption Policy","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: transit-encrypt\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"transit/encrypt/{{namespace}}-key\"\n      capabilities: [update]\n      description: \"Encrypt data\"\n    - path: \"transit/decrypt/{{namespace}}-key\"\n      capabilities: [update]\n      description: \"Decrypt data\"\n</code></pre>"},{"location":"examples/#retain-on-delete","title":"Retain on Delete","text":"<p>Keep the policy in Vault when the Kubernetes resource is deleted:</p> <pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: persistent-policy\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  deletionPolicy: Retain\n  rules:\n    - path: \"secret/data/{{namespace}}/*\"\n      capabilities: [read]\n</code></pre>"},{"location":"examples/#vaultclusterpolicy-examples","title":"VaultClusterPolicy Examples","text":""},{"location":"examples/#shared-secrets-reader","title":"Shared Secrets Reader","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterPolicy\nmetadata:\n  name: shared-secrets-reader\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/data/shared/*\"\n      capabilities: [read, list]\n      description: \"Read shared configuration\"\n    - path: \"secret/data/global/config\"\n      capabilities: [read]\n      description: \"Read global config\"\n</code></pre>"},{"location":"examples/#platform-admin-policy","title":"Platform Admin Policy","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterPolicy\nmetadata:\n  name: platform-admin\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/*\"\n      capabilities: [create, read, update, delete, list]\n    - path: \"auth/kubernetes/role/*\"\n      capabilities: [read, list]\n    - path: \"sys/policies/acl/*\"\n      capabilities: [read, list]\n</code></pre>"},{"location":"examples/#cicd-pipeline-secrets","title":"CI/CD Pipeline Secrets","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterPolicy\nmetadata:\n  name: cicd-secrets\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/data/cicd/*\"\n      capabilities: [read, list]\n      description: \"Read CI/CD secrets\"\n    - path: \"secret/data/docker-registry\"\n      capabilities: [read]\n      description: \"Docker registry credentials\"\n</code></pre>"},{"location":"examples/#pki-certificate-issuer","title":"PKI Certificate Issuer","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterPolicy\nmetadata:\n  name: pki-issuer\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"pki/issue/internal\"\n      capabilities: [create, update]\n      description: \"Issue internal certificates\"\n    - path: \"pki/ca/pem\"\n      capabilities: [read]\n      description: \"Read CA certificate\"\n</code></pre>"},{"location":"examples/#vaultrole-examples","title":"VaultRole Examples","text":""},{"location":"examples/#basic-application-role","title":"Basic Application Role","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultRole\nmetadata:\n  name: app-role\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - default\n  policies:\n    - kind: VaultPolicy\n      name: app-secrets\n  tokenTTL: 1h\n  tokenMaxTTL: 4h\n</code></pre>"},{"location":"examples/#multiple-service-accounts","title":"Multiple Service Accounts","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultRole\nmetadata:\n  name: backend-services\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - api-server\n    - worker\n    - scheduler\n  policies:\n    - kind: VaultPolicy\n      name: backend-secrets\n  tokenTTL: 30m\n</code></pre>"},{"location":"examples/#mixed-policy-types","title":"Mixed Policy Types","text":"<p>Combine namespace-scoped and cluster-wide policies:</p> <pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultRole\nmetadata:\n  name: full-access\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - default\n  policies:\n    - kind: VaultPolicy\n      name: app-secrets\n    - kind: VaultClusterPolicy\n      name: shared-config-reader\n    - kind: VaultClusterPolicy\n      name: database-readonly\n  tokenTTL: 1h\n</code></pre>"},{"location":"examples/#short-lived-tokens-for-batch-jobs","title":"Short-lived Tokens for Batch Jobs","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultRole\nmetadata:\n  name: batch-job\n  namespace: batch\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - batch-runner\n  policies:\n    - kind: VaultPolicy\n      name: batch-secrets\n  tokenTTL: 5m\n  tokenMaxTTL: 15m\n</code></pre>"},{"location":"examples/#vaultclusterrole-examples","title":"VaultClusterRole Examples","text":""},{"location":"examples/#platform-services-role","title":"Platform Services Role","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterRole\nmetadata:\n  name: platform-services\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - name: platform-controller\n      namespace: platform-system\n    - name: monitoring-agent\n      namespace: monitoring\n    - name: logging-collector\n      namespace: logging\n  policies:\n    - kind: VaultClusterPolicy\n      name: shared-secrets-reader\n  tokenTTL: 1h\n  tokenMaxTTL: 24h\n</code></pre>"},{"location":"examples/#cicd-pipeline-role","title":"CI/CD Pipeline Role","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterRole\nmetadata:\n  name: cicd-pipeline\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - name: tekton-pipeline\n      namespace: tekton-pipelines\n    - name: argo-workflow\n      namespace: argo\n    - name: github-actions-runner\n      namespace: actions-runner-system\n  policies:\n    - kind: VaultClusterPolicy\n      name: cicd-secrets\n  tokenTTL: 15m\n  tokenMaxTTL: 1h\n</code></pre>"},{"location":"examples/#ingress-controller-role","title":"Ingress Controller Role","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterRole\nmetadata:\n  name: ingress-controller\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - name: nginx-ingress-controller\n      namespace: ingress-nginx\n  policies:\n    - kind: VaultClusterPolicy\n      name: pki-issuer\n  tokenTTL: 30m\n</code></pre>"},{"location":"examples/#external-secrets-operator-role","title":"External Secrets Operator Role","text":"<pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterRole\nmetadata:\n  name: external-secrets\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - name: external-secrets\n      namespace: external-secrets\n  policies:\n    - kind: VaultClusterPolicy\n      name: secrets-reader-all\n  tokenTTL: 1h\n  tokenMaxTTL: 4h\n</code></pre>"},{"location":"examples/#complete-application-setup","title":"Complete Application Setup","text":"<p>A complete example for setting up Vault access for a microservices application:</p> <pre><code>---\n# 1. Shared policy for all services\napiVersion: vault.platform.io/v1alpha1\nkind: VaultClusterPolicy\nmetadata:\n  name: shared-config\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/data/shared/database\"\n      capabilities: [read]\n    - path: \"secret/data/shared/messaging\"\n      capabilities: [read]\n---\n# 2. Namespace-specific policy\napiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: api-service\n  namespace: production\nspec:\n  connectionRef: vault-primary\n  enforceNamespaceBoundary: true\n  rules:\n    - path: \"secret/data/{{namespace}}/api/*\"\n      capabilities: [read, list]\n---\n# 3. Role binding for API service\napiVersion: vault.platform.io/v1alpha1\nkind: VaultRole\nmetadata:\n  name: api-service\n  namespace: production\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - api-service\n  policies:\n    - kind: VaultPolicy\n      name: api-service\n    - kind: VaultClusterPolicy\n      name: shared-config\n  tokenTTL: 1h\n---\n# 4. Service account for the application\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: api-service\n  namespace: production\n---\n# 5. Application deployment\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: api-service\n  namespace: production\nspec:\n  selector:\n    matchLabels:\n      app: api-service\n  template:\n    metadata:\n      labels:\n        app: api-service\n    spec:\n      serviceAccountName: api-service\n      containers:\n        - name: api\n          image: my-api:latest\n          env:\n            - name: VAULT_ADDR\n              value: \"https://vault.example.com:8200\"\n            - name: VAULT_AUTH_ROLE\n              value: \"production-api-service\"\n</code></pre>"},{"location":"examples/#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started - Installation guide</li> <li>API Reference - CRD field documentation</li> <li>Configuration - Helm chart options</li> <li>Troubleshooting - Common issues</li> </ul>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide walks you through installing the Vault Access Operator and creating your first resources.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":""},{"location":"getting-started/#kubernetes-cluster","title":"Kubernetes Cluster","text":"<ul> <li>Kubernetes v1.25 or later</li> <li><code>kubectl</code> configured to access your cluster</li> <li>Cluster admin permissions for installing CRDs</li> </ul> <pre><code>kubectl version\nkubectl cluster-info\n</code></pre>"},{"location":"getting-started/#hashicorp-vault","title":"HashiCorp Vault","text":"<ul> <li>Vault server v1.12 or later</li> <li>Vault unsealed and accessible from your Kubernetes cluster</li> <li>Kubernetes authentication method enabled</li> </ul> <p>To enable the Kubernetes auth method in Vault:</p> <pre><code>vault auth enable kubernetes\n\nvault write auth/kubernetes/config \\\n    kubernetes_host=\"https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_SERVICE_PORT\" \\\n    kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n</code></pre>"},{"location":"getting-started/#cert-manager-optional","title":"cert-manager (Optional)","text":"<p>cert-manager is recommended for managing webhook certificates:</p> <pre><code>kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.0/cert-manager.yaml\nkubectl wait --for=condition=Available deployment --all -n cert-manager --timeout=300s\n</code></pre> <p>Without cert-manager</p> <p>You can disable webhooks or use self-signed certificates. See Configuration for details.</p>"},{"location":"getting-started/#installation","title":"Installation","text":"Helm (Recommended)kubectlFrom Source <pre><code>helm repo add vault-access-operator https://panteparak.github.io/vault-access-operator/charts\nhelm repo update\n\nhelm install vault-access-operator vault-access-operator/vault-access-operator \\\n  --namespace vault-access-operator-system \\\n  --create-namespace\n</code></pre> <pre><code>kubectl apply -f https://raw.githubusercontent.com/panteparak/vault-access-operator/main/dist/install.yaml\n</code></pre> <pre><code>git clone https://github.com/panteparak/vault-access-operator.git\ncd vault-access-operator\nmake install\nmake deploy IMG=ghcr.io/panteparak/vault-access-operator:latest\n</code></pre>"},{"location":"getting-started/#verify-installation","title":"Verify Installation","text":"<pre><code># Check operator pod\nkubectl get pods -n vault-access-operator-system\n\n# Check CRDs\nkubectl get crds | grep vault.platform.io\n</code></pre>"},{"location":"getting-started/#configure-vault-for-the-operator","title":"Configure Vault for the Operator","text":"<p>Before creating resources, configure Vault to allow the operator to manage policies and roles.</p>"},{"location":"getting-started/#create-operator-policy","title":"Create Operator Policy","text":"<pre><code>vault policy write vault-access-operator - &lt;&lt;EOF\n# Manage policies\npath \"sys/policies/acl/*\" {\n  capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\npath \"sys/policies/acl\" {\n  capabilities = [\"list\"]\n}\n\n# Manage Kubernetes auth roles\npath \"auth/kubernetes/role/*\" {\n  capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\npath \"auth/kubernetes/role\" {\n  capabilities = [\"list\"]\n}\n\n# Health check\npath \"sys/health\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"getting-started/#create-kubernetes-auth-role","title":"Create Kubernetes Auth Role","text":"<pre><code>vault write auth/kubernetes/role/vault-access-operator \\\n    bound_service_account_names=vault-access-operator-controller-manager \\\n    bound_service_account_namespaces=vault-access-operator-system \\\n    policies=vault-access-operator \\\n    ttl=1h\n</code></pre>"},{"location":"getting-started/#quick-start-create-your-first-resources","title":"Quick Start: Create Your First Resources","text":""},{"location":"getting-started/#step-1-create-a-vaultconnection","title":"Step 1: Create a VaultConnection","text":"<pre><code># vault-connection.yaml\napiVersion: vault.platform.io/v1alpha1\nkind: VaultConnection\nmetadata:\n  name: vault-primary\nspec:\n  address: https://vault.example.com:8200\n  auth:\n    kubernetes:\n      role: vault-access-operator\n  tls:\n    skipVerify: false  # Set to true for testing only\n</code></pre> <pre><code>kubectl apply -f vault-connection.yaml\nkubectl get vaultconnection vault-primary\n</code></pre> <p>Expected output: <pre><code>NAME            ADDRESS                          PHASE    VERSION   AGE\nvault-primary   https://vault.example.com:8200   Active   1.15.0    30s\n</code></pre></p>"},{"location":"getting-started/#step-2-create-a-vaultpolicy","title":"Step 2: Create a VaultPolicy","text":"<pre><code># app-secrets-policy.yaml\napiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: app-secrets\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  rules:\n    - path: \"secret/data/{{namespace}}/*\"\n      capabilities: [read, list]\n      description: \"Read secrets for this namespace\"\n</code></pre> <pre><code>kubectl create namespace my-app\nkubectl apply -f app-secrets-policy.yaml\nkubectl get vaultpolicy -n my-app\n</code></pre>"},{"location":"getting-started/#step-3-create-a-vaultrole","title":"Step 3: Create a VaultRole","text":"<pre><code># app-role.yaml\napiVersion: vault.platform.io/v1alpha1\nkind: VaultRole\nmetadata:\n  name: app-role\n  namespace: my-app\nspec:\n  connectionRef: vault-primary\n  serviceAccounts:\n    - default\n  policies:\n    - kind: VaultPolicy\n      name: app-secrets\n  tokenTTL: 1h\n  tokenMaxTTL: 4h\n</code></pre> <pre><code>kubectl apply -f app-role.yaml\nkubectl get vaultrole -n my-app\n</code></pre>"},{"location":"getting-started/#step-4-test-authentication","title":"Step 4: Test Authentication","text":"<pre><code># test-pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: vault-test\n  namespace: my-app\nspec:\n  serviceAccountName: default\n  containers:\n    - name: vault\n      image: hashicorp/vault:latest\n      command: [\"sleep\", \"infinity\"]\n      env:\n        - name: VAULT_ADDR\n          value: \"https://vault.example.com:8200\"\n</code></pre> <pre><code>kubectl apply -f test-pod.yaml\nkubectl exec -it vault-test -n my-app -- vault login -method=kubernetes role=my-app-app-role\n</code></pre>"},{"location":"getting-started/#summary","title":"Summary","text":"<p>You've successfully:</p> <ol> <li>Installed the Vault Access Operator</li> <li>Connected to your Vault server using <code>VaultConnection</code></li> <li>Created a policy using <code>VaultPolicy</code></li> <li>Created a role using <code>VaultRole</code> to bind service accounts to policies</li> <li>Tested Vault authentication from a Kubernetes pod</li> </ol> Resource Scope Description VaultConnection Cluster Establishes connection to Vault VaultPolicy Namespaced Namespace-scoped Vault policy VaultClusterPolicy Cluster Cluster-wide Vault policy VaultRole Namespaced Namespace-scoped Kubernetes auth role VaultClusterRole Cluster Cluster-wide Kubernetes auth role"},{"location":"getting-started/#uninstallation","title":"Uninstallation","text":"Helmkubectl <pre><code>helm uninstall vault-access-operator -n vault-access-operator-system\n\n# Optionally delete CRDs (this deletes all managed resources!)\nkubectl delete crds \\\n  vaultconnections.vault.platform.io \\\n  vaultpolicies.vault.platform.io \\\n  vaultclusterpolicies.vault.platform.io \\\n  vaultroles.vault.platform.io \\\n  vaultclusterroles.vault.platform.io\n\nkubectl delete namespace vault-access-operator-system\n</code></pre> <pre><code>kubectl delete -f https://raw.githubusercontent.com/panteparak/vault-access-operator/main/dist/install.yaml\n</code></pre>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration - Helm chart options</li> <li>API Reference - Detailed CRD documentation</li> <li>Examples - More usage examples</li> <li>Troubleshooting - Common issues and solutions</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting Guide","text":"<p>This guide helps you diagnose and resolve common issues with the Vault Access Operator.</p>"},{"location":"troubleshooting/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Common Issues</li> <li>VaultConnection Issues</li> <li>VaultPolicy Issues</li> <li>VaultRole Issues</li> <li>Webhook Issues</li> <li>Debugging Techniques</li> <li>Log Analysis</li> <li>Status Conditions Explained</li> </ul>"},{"location":"troubleshooting/#common-issues","title":"Common Issues","text":""},{"location":"troubleshooting/#vaultconnection-issues","title":"VaultConnection Issues","text":""},{"location":"troubleshooting/#connection-stuck-in-pending-phase","title":"Connection Stuck in \"Pending\" Phase","text":"<p>Symptoms: <pre><code>kubectl get vaultconnection\nNAME            ADDRESS                          PHASE     VERSION   AGE\nvault-primary   https://vault.example.com:8200   Pending             5m\n</code></pre></p> <p>Possible Causes:</p> <ol> <li> <p>Operator not running: Check if the operator pod is running.    <pre><code>kubectl get pods -n vault-access-operator-system\n</code></pre></p> </li> <li> <p>Invalid Vault address: Verify the address is correct and reachable.    <pre><code>kubectl describe vaultconnection vault-primary\n</code></pre></p> </li> <li> <p>Network connectivity: The operator cannot reach Vault.    <pre><code># Test from a pod in the same namespace as the operator\nkubectl run -it --rm debug --image=curlimages/curl -- curl -k https://vault.example.com:8200/v1/sys/health\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#connection-in-error-phase","title":"Connection in \"Error\" Phase","text":"<p>Symptoms: <pre><code>kubectl get vaultconnection\nNAME            ADDRESS                          PHASE   VERSION   AGE\nvault-primary   https://vault.example.com:8200   Error             5m\n</code></pre></p> <p>Check the error message: <pre><code>kubectl describe vaultconnection vault-primary\n</code></pre></p> <p>Common error causes:</p> <ol> <li>TLS Certificate Issues</li> <li>Error: <code>x509: certificate signed by unknown authority</code></li> <li> <p>Solution: Provide the correct CA certificate or set <code>skipVerify: true</code> (not recommended for production).    <pre><code>spec:\n  tls:\n    caSecretRef:\n      name: vault-ca-cert\n      namespace: vault-access-operator-system\n      key: ca.crt\n</code></pre></p> </li> <li> <p>Authentication Failure</p> </li> <li>Error: <code>permission denied</code> or <code>invalid role</code></li> <li> <p>Solution: Verify the Vault role exists and the service account is bound correctly.    <pre><code># Check if the role exists in Vault\nvault read auth/kubernetes/role/vault-access-operator\n\n# Verify the operator service account\nkubectl get sa -n vault-access-operator-system\n</code></pre></p> </li> <li> <p>Vault Sealed</p> </li> <li>Error: <code>Vault is sealed</code></li> <li>Solution: Unseal the Vault server.    <pre><code>vault status\nvault operator unseal\n</code></pre></li> </ol>"},{"location":"troubleshooting/#connection-authentication-failures","title":"Connection Authentication Failures","text":"<p>Symptoms: <pre><code>Error: failed to authenticate: permission denied\n</code></pre></p> <p>Debugging steps:</p> <ol> <li> <p>Verify Kubernetes auth is enabled: <pre><code>vault auth list\n</code></pre></p> </li> <li> <p>Check the Vault role configuration: <pre><code>vault read auth/kubernetes/role/vault-access-operator\n</code></pre></p> </li> <li> <p>Verify service account binding: <pre><code># The role should allow:\n# - bound_service_account_names: vault-access-operator-controller-manager\n# - bound_service_account_namespaces: vault-access-operator-system\n</code></pre></p> </li> <li> <p>Test authentication manually: <pre><code># Get a shell in the operator pod\nkubectl exec -it deploy/vault-access-operator-controller-manager \\\n  -n vault-access-operator-system -- /bin/sh\n\n# Check the service account token\ncat /var/run/secrets/kubernetes.io/serviceaccount/token\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#vaultpolicy-issues","title":"VaultPolicy Issues","text":""},{"location":"troubleshooting/#policy-stuck-in-syncing-phase","title":"Policy Stuck in \"Syncing\" Phase","text":"<p>Symptoms: <pre><code>kubectl get vaultpolicy -n my-app\nNAME          VAULT NAME         PHASE     RULES   AGE\napp-secrets   my-app-app-secrets Syncing   3       5m\n</code></pre></p> <p>Possible causes:</p> <ol> <li> <p>VaultConnection not ready: <pre><code>kubectl get vaultconnection\n# Ensure the referenced connection is in \"Active\" phase\n</code></pre></p> </li> <li> <p>Insufficient Vault permissions: <pre><code># Check operator logs\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager\n\n# Ensure the Vault policy allows policy management\nvault policy read vault-access-operator\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#policy-in-conflict-phase","title":"Policy in \"Conflict\" Phase","text":"<p>Symptoms: <pre><code>kubectl get vaultpolicy -n my-app\nNAME          VAULT NAME         PHASE      RULES   AGE\napp-secrets   my-app-app-secrets Conflict   3       5m\n</code></pre></p> <p>Explanation: A policy with the same name already exists in Vault and is either: - Managed by a different Kubernetes resource - Not managed by the operator at all</p> <p>Solutions:</p> <ol> <li> <p>Use Adopt conflict policy: <pre><code>spec:\n  conflictPolicy: Adopt  # Take over the existing policy\n</code></pre></p> </li> <li> <p>Delete the existing policy from Vault: <pre><code>vault policy delete my-app-app-secrets\n</code></pre></p> </li> <li> <p>Rename your VaultPolicy resource: <pre><code>metadata:\n  name: app-secrets-v2  # Will create: my-app-app-secrets-v2\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#namespace-boundary-validation-error","title":"Namespace Boundary Validation Error","text":"<p>Symptoms: <pre><code>Error: validation failed: rule[0]: path \"secret/data/*\" must contain {{namespace}} when namespace boundary enforcement is enabled\n</code></pre></p> <p>Solution: Add the <code>{{namespace}}</code> variable to your paths, or disable namespace boundary enforcement:</p> <p>Option 1: Add namespace variable (recommended for multi-tenant environments): <pre><code>spec:\n  enforceNamespaceBoundary: true  # Explicitly enabled (default is false)\n  rules:\n    - path: \"secret/data/{{namespace}}/*\"  # Correct\n      capabilities: [read, list]\n</code></pre></p> <p>Option 2: Disable enforcement (default behavior): <pre><code>spec:\n  enforceNamespaceBoundary: false  # This is the default\n  rules:\n    - path: \"secret/data/*\"\n      capabilities: [read, list]\n</code></pre></p>"},{"location":"troubleshooting/#wildcard-before-namespace-error","title":"Wildcard Before Namespace Error","text":"<p>Symptoms: <pre><code>Error: validation failed: rule[0]: path \"secret/*/{{namespace}}/data\" contains wildcard (*) before {{namespace}} which is a security risk\n</code></pre></p> <p>Explanation: Having a wildcard before <code>{{namespace}}</code> could allow access to secrets in other namespaces.</p> <p>Solution: Restructure your path: <pre><code># Bad\n- path: \"secret/*/{{namespace}}/data\"\n\n# Good\n- path: \"secret/data/{{namespace}}/*\"\n- path: \"kv/{{namespace}}/data/*\"\n</code></pre></p>"},{"location":"troubleshooting/#vaultrole-issues","title":"VaultRole Issues","text":""},{"location":"troubleshooting/#role-in-error-phase-with-policynotfound","title":"Role in \"Error\" Phase with PolicyNotFound","text":"<p>Symptoms: <pre><code>kubectl describe vaultrole app-role -n my-app\n# Status shows: policy VaultPolicy \"missing-policy\" not found in namespace \"my-app\"\n</code></pre></p> <p>Solutions:</p> <ol> <li> <p>Create the missing policy: <pre><code>apiVersion: vault.platform.io/v1alpha1\nkind: VaultPolicy\nmetadata:\n  name: missing-policy\n  namespace: my-app\nspec:\n  # ... policy configuration\n</code></pre></p> </li> <li> <p>Fix the policy reference: <pre><code>spec:\n  policies:\n    - kind: VaultPolicy\n      name: correct-policy-name\n</code></pre></p> </li> <li> <p>If referencing a policy in another namespace: <pre><code>spec:\n  policies:\n    - kind: VaultPolicy\n      name: shared-policy\n      namespace: shared-namespace\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#service-account-not-authorized","title":"Service Account Not Authorized","text":"<p>Symptoms: - Application pods cannot authenticate to Vault - Error: <code>role not found</code> or <code>service account not authorized</code></p> <p>Debugging steps:</p> <ol> <li> <p>Check the VaultRole status: <pre><code>kubectl get vaultrole app-role -n my-app -o yaml\n# Verify boundServiceAccounts in status\n</code></pre></p> </li> <li> <p>Verify the service account exists: <pre><code>kubectl get sa -n my-app\n</code></pre></p> </li> <li> <p>Check the role in Vault: <pre><code>vault read auth/kubernetes/role/my-app-app-role\n</code></pre></p> </li> <li> <p>Test authentication: <pre><code>kubectl run -it --rm debug \\\n  --image=hashicorp/vault \\\n  --serviceaccount=app-service-account \\\n  -n my-app -- \\\n  vault login -method=kubernetes role=my-app-app-role\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#webhook-issues","title":"Webhook Issues","text":""},{"location":"troubleshooting/#webhook-certificate-errors","title":"Webhook Certificate Errors","text":"<p>Symptoms: <pre><code>Error creating: Internal error occurred: failed calling webhook:\nx509: certificate signed by unknown authority\n</code></pre></p> <p>Solutions:</p> <ol> <li> <p>If using cert-manager, verify the certificate: <pre><code>kubectl get certificate -n vault-access-operator-system\nkubectl describe certificate vault-access-operator-webhook-cert \\\n  -n vault-access-operator-system\n</code></pre></p> </li> <li> <p>Check cert-manager is working: <pre><code>kubectl get pods -n cert-manager\nkubectl logs -n cert-manager deploy/cert-manager\n</code></pre></p> </li> <li> <p>Restart the operator to pick up new certificate: <pre><code>kubectl rollout restart deployment vault-access-operator-controller-manager \\\n  -n vault-access-operator-system\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#webhook-timeout","title":"Webhook Timeout","text":"<p>Symptoms: <pre><code>Error: context deadline exceeded (Client.Timeout exceeded while awaiting headers)\n</code></pre></p> <p>Solutions:</p> <ol> <li> <p>Check operator health: <pre><code>kubectl get pods -n vault-access-operator-system\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager\n</code></pre></p> </li> <li> <p>Increase webhook timeout: <pre><code># In Helm values\nwebhook:\n  timeoutSeconds: 30\n</code></pre></p> </li> <li> <p>Check network policies: <pre><code>kubectl get networkpolicy -n vault-access-operator-system\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#debugging-techniques","title":"Debugging Techniques","text":""},{"location":"troubleshooting/#enable-debug-logging","title":"Enable Debug Logging","text":"<p>Increase log verbosity for more detailed output:</p> <pre><code># Helm values\nlogging:\n  level: debug\n</code></pre> <p>Or set environment variable: <pre><code>kubectl set env deployment/vault-access-operator-controller-manager \\\n  -n vault-access-operator-system \\\n  -- ZAP_LOG_LEVEL=debug\n</code></pre></p>"},{"location":"troubleshooting/#check-resource-events","title":"Check Resource Events","text":"<pre><code>kubectl get events --field-selector involvedObject.name=app-secrets -n my-app\n</code></pre>"},{"location":"troubleshooting/#inspect-resource-details","title":"Inspect Resource Details","text":"<pre><code># Full resource with status\nkubectl get vaultpolicy app-secrets -n my-app -o yaml\n\n# Just the status\nkubectl get vaultpolicy app-secrets -n my-app -o jsonpath='{.status}'\n\n# Just conditions\nkubectl get vaultpolicy app-secrets -n my-app \\\n  -o jsonpath='{.status.conditions}' | jq .\n</code></pre>"},{"location":"troubleshooting/#test-vault-connectivity-from-operator","title":"Test Vault Connectivity from Operator","text":"<pre><code># Get a shell in the operator pod\nkubectl exec -it deploy/vault-access-operator-controller-manager \\\n  -n vault-access-operator-system -- /bin/sh\n\n# Test Vault health\nwget -qO- https://vault.example.com:8200/v1/sys/health\n\n# Check environment\nenv | grep VAULT\n</code></pre>"},{"location":"troubleshooting/#verify-crd-installation","title":"Verify CRD Installation","text":"<pre><code># List CRDs\nkubectl get crds | grep vault.platform.io\n\n# Check CRD details\nkubectl describe crd vaultpolicies.vault.platform.io\n</code></pre>"},{"location":"troubleshooting/#log-analysis","title":"Log Analysis","text":""},{"location":"troubleshooting/#operator-log-locations","title":"Operator Log Locations","text":"<pre><code># Stream logs from the operator\nkubectl logs -f -n vault-access-operator-system deploy/vault-access-operator-controller-manager\n\n# Get logs from the last hour\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager \\\n  --since=1h\n\n# Get logs from a crashed pod\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager \\\n  --previous\n</code></pre>"},{"location":"troubleshooting/#common-log-patterns","title":"Common Log Patterns","text":""},{"location":"troubleshooting/#successful-reconciliation","title":"Successful Reconciliation","text":"<pre><code>{\"level\":\"info\",\"ts\":\"...\",\"msg\":\"Reconciling VaultPolicy\",\"namespace\":\"my-app\",\"name\":\"app-secrets\"}\n{\"level\":\"info\",\"ts\":\"...\",\"msg\":\"VaultPolicy reconciled successfully\",\"namespace\":\"my-app\",\"name\":\"app-secrets\",\"vaultName\":\"my-app-app-secrets\"}\n</code></pre>"},{"location":"troubleshooting/#connection-error","title":"Connection Error","text":"<pre><code>{\"level\":\"error\",\"ts\":\"...\",\"msg\":\"Failed to get Vault client\",\"error\":\"connection \\\"vault-primary\\\" not ready: VaultConnection is in Pending phase\"}\n</code></pre>"},{"location":"troubleshooting/#conflict-detection","title":"Conflict Detection","text":"<pre><code>{\"level\":\"error\",\"ts\":\"...\",\"msg\":\"Conflict detected\",\"error\":\"conflict: policy \\\"my-app-app-secrets\\\": already managed by other-namespace/other-policy\"}\n</code></pre>"},{"location":"troubleshooting/#retry-scheduling","title":"Retry Scheduling","text":"<pre><code>{\"level\":\"info\",\"ts\":\"...\",\"msg\":\"Scheduling retry\",\"retryCount\":2,\"nextRetryIn\":\"20s\"}\n</code></pre>"},{"location":"troubleshooting/#filtering-logs","title":"Filtering Logs","text":"<pre><code># Only errors\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager \\\n  | grep '\"level\":\"error\"'\n\n# Specific resource\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager \\\n  | grep '\"name\":\"app-secrets\"'\n\n# Using jq for JSON logs\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager \\\n  | jq 'select(.level == \"error\")'\n</code></pre>"},{"location":"troubleshooting/#status-conditions-explained","title":"Status Conditions Explained","text":""},{"location":"troubleshooting/#condition-types","title":"Condition Types","text":"Type Description Healthy State <code>Ready</code> Resource is fully reconciled and operational <code>True</code> <code>Synced</code> Resource has been successfully synced to Vault <code>True</code> <code>ConnectionReady</code> Referenced VaultConnection is available <code>True</code> <code>PoliciesResolved</code> All referenced policies have been found and resolved <code>True</code>"},{"location":"troubleshooting/#condition-reasons","title":"Condition Reasons","text":"Reason Description Action <code>Succeeded</code> Operation completed successfully None needed <code>Failed</code> Operation failed Check message and logs <code>InProgress</code> Operation is ongoing Wait for completion <code>Conflict</code> Conflict with existing Vault resource Use Adopt policy or resolve manually <code>ValidationFailed</code> Resource spec validation failed Fix spec according to error <code>ConnectionNotReady</code> VaultConnection is not active Fix VaultConnection <code>PolicyNotFound</code> Referenced policy doesn't exist Create the policy"},{"location":"troubleshooting/#reading-conditions","title":"Reading Conditions","text":"<pre><code># Get all conditions\nkubectl get vaultpolicy app-secrets -n my-app \\\n  -o jsonpath='{range .status.conditions[*]}{.type}: {.status} ({.reason}) - {.message}{\"\\n\"}{end}'\n\n# Example output:\n# Ready: False (ConnectionNotReady) - connection \"vault-primary\" not ready: VaultConnection is in Error phase\n# Synced: False (Failed) - failed to sync policy to Vault\n</code></pre>"},{"location":"troubleshooting/#interpreting-multiple-conditions","title":"Interpreting Multiple Conditions","text":"<p>Healthy resource: <pre><code>Ready: True (Succeeded) - Policy synced to Vault\nSynced: True (Succeeded) - Policy synced successfully\n</code></pre></p> <p>Connection issue: <pre><code>Ready: False (ConnectionNotReady) - connection \"vault-primary\" not ready\nSynced: False (Failed) - cannot sync without connection\n</code></pre></p> <p>Conflict detected: <pre><code>Ready: False (Conflict) - policy already exists and is managed by other-ns/other-policy\nSynced: False (Conflict) - cannot sync due to conflict\n</code></pre></p>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<p>If you're still experiencing issues:</p> <ol> <li> <p>Check the GitHub Issues: github.com/panteparak/vault-access-operator/issues</p> </li> <li> <p>Collect diagnostic information: <pre><code># Export all vault resources\nkubectl get vaultconnections,vaultclusterpolicies,vaultpolicies,vaultclusterroles,vaultroles \\\n  -A -o yaml &gt; vault-resources.yaml\n\n# Get operator logs\nkubectl logs -n vault-access-operator-system deploy/vault-access-operator-controller-manager \\\n  --since=1h &gt; operator-logs.txt\n\n# Get events\nkubectl get events -A --field-selector reason!=Normal &gt; events.txt\n</code></pre></p> </li> <li> <p>Open an issue with the diagnostic information (remove any sensitive data like tokens or secrets).</p> </li> </ol>"}]}